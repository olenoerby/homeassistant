#
# HOME CONTROL
#

#Notify about Updates available
- alias: Update Available Notifications
  trigger:
    - platform: state
      entity_id: updater.updater
  action:
    - service: notify.jeeves
      data_template:
        message: !include response_texts/homeassistant_new_update.yaml
        target: !secret ole_phone_number


#
# PEOPLE AT HOME
#

- alias: 'Good Morning Weekday Message'
  trigger:
    platform: time
    at: '09:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'binary_sensor.workday_sensor'
        state: 'on'
  action:
    - service: notify.jeeves
      data_template:
        message: !include response_texts/jeeves_morning_greeting.yaml
        target: !secret ole_phone_number

- alias: 'Good Morning Weekend Message'
  trigger:
    platform: time
    at: '09:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: 'binary_sensor.workday_sensor'
        state: 'off'
  action:
    - service: notify.jeeves
      data_template:
        message: !include response_texts/jeeves_morning_greeting.yaml
        target: !secret ole_phone_number


#
# COMING HOME 
#


# Sig velkommen hjem
- alias: 'Jeeves Welcome Home Greeting'
  trigger:
    - platform: zone
      event: enter
      zone: zone.home
      entity_id: device_tracker.ole_telefon
  condition:
    condition: time
    after: '12:00'
  action:
    - service: notify.jeeves
      data_template:
        message: !include response_texts/jeeves_time_of_day.yaml
        target: !secret ole_phone_number
    - service: notify.jeeves
      data:
        message: !include response_texts/jeeves_welcome_home.yaml
        target: !secret ole_phone_number

# Turn on light in hallway when entering home zone
- alias: Home zone - Turn on light when home
  trigger:
    platform: state
    entity_id: device_tracker.ole_telefon
    to: 'home'
  action:
    - service: homeassistant.turn_on
      entity_id: light.entre_loftlampe
    - service: notify.jeeves
      data:
        message: 'You have been detected close to Home, and I have turned on the light in the Hall, Sir.'
        target: !secret ole_phone_number

# Turn off light in hallway when leaving home zone 15 minutes ago 
- alias: Home zone - Turn on light when evening
  trigger:
    platform: state
    entity_id: device_tracker.ole_telefon
    to: 'not_home'
    for:
      minutes: 15
  action:
    - service: homeassistant.turn_off
      entity_id: light.entre_loftlampe
    - service: notify.jeeves
      data:
        message: 'I have turned off the light in the hallway.'
        target: !secret ole_phone_number

#
# LEAVING HOME 
#

# Home presence - Ole
- alias: 'Ole Presence Detected Away'
  hide_entity: True
  trigger:
    - platform: state
      entity_id: device_tracker.ole_telefon
      to: 'not_home' 
      for:
        minutes: 10
    - platform: state
      entity_id: device_tracker.argos
      to: 'not_home' 
  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.ole_home

# Hvis Telefon eller Macbook er hjemme eller Mac online er Ole hjemme
- alias: 'Ole Presence Detected Home'
  hide_entity: True
  trigger:
    - platform: state
      entity_id: device_tracker.ole_telefon
      to: 'home' 
    - platform: state
      entity_id: device_tracker.argos
      to: 'home' 
  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.ole_home

#
#
#


- alias: 'Jeeves Nice Day notification'
  trigger:
    - platform: zone
      event: leave
      zone: zone.home
      entity_id: device_tracker.ole_telefon
  condition:
    - condition: time
      before: '10:00:00'
  action:
    - service: notify.jeeves
      data:
        message: "I have turned off the lights because you left. Have a nice day, Sir."
        target: !secret ole_phone_number
    - service: light.turn_off
      entity_id: group.all_lights


#
# TEST 
#

- alias: 'Test Message'
  initial_state: 'off'
  trigger:
  action:
    - service: notify.jeeves
      data_template:
        message: !include response_texts/test.yaml
        target: !secret ole_phone_number